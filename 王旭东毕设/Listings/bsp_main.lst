C51 COMPILER V9.60.0.0   BSP_MAIN                                                          02/13/2020 15:18:50 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE BSP_MAIN
OBJECT MODULE PLACED IN ..\Objects\bsp_main.obj
COMPILER INVOKED BY: C:\keil\C51\BIN\C51.EXE ..\user\bsp_main.c OPTIMIZE(8,SPEED) BROWSE INCDIR(..\user;..\BSP\inc) DEBU
                    -G OBJECTEXTEND PRINT(..\Listings\bsp_main.lst) OBJECT(..\Objects\bsp_main.obj)

line level    source

   1          #include "inc.h"
   2          
   3          typedef struct _Dishe
   4          {
   5                  char* DisheName;
   6                  float price;
   7          }Dishes;
   8          
   9          typedef struct _info
  10          {
  11                  float weight;
  12                  float price;
  13                  float money;
  14                  int Num;
  15          }Info;
  16          
  17          xdata Dishes temp[] ={
  18          {"qingcai",2.2},
  19          {"dabaicai",2.8},
  20          {"xiguan",4.9},
  21          {"xiangjiao",71.3},
  22          {"xihongshi",88.2},
  23          {"niunan",99},
  24          {"jinju",19},
  25          {"niunan",22},
  26          {"qiezi",33},
  27          {"huasheng",55},
  28          {"niunai",88},};
  29          
  30          Info Dishes_Info = {0,2.2,0,0};
  31          
  32          
  33          void Delay200ms()               //@11.0592MHz
  34          {
  35   1              unsigned char i, j, k;
  36   1      
  37   1              _nop_();
  38   1              i = 2;
  39   1              j = 103;
  40   1              k = 147;
  41   1              do
  42   1              {
  43   2                      do
  44   2                      {
  45   3                              while (--k);
  46   3                      } while (--j);
  47   2              } while (--i);
  48   1      }
  49          
  50          
  51          
  52          
  53          void lcd_display(void);
  54          char xdata str[35] = 0;
C51 COMPILER V9.60.0.0   BSP_MAIN                                                          02/13/2020 15:18:50 PAGE 2   

  55          void main(void)
  56          {
  57   1              char key = 0;
  58   1              uint8_t flag = 0;
  59   1              
  60   1              lcd_display();
  61   1              Timer0Init();
  62   1              UartInit();
  63   1              while(1)
  64   1              {
  65   2                      key = Get_KeyPad();
  66   2                      Dishes_Info.weight = GetTcl1543();
  67   2                      sprintf(str, "电压值:%f, key:%c\n",Dishes_Info.weight * 5 /4095,key);
  68   2                      Send_String(str);
  69   2                      if(flag != 2)
  70   2                      {
  71   3                              sprintf(str, "WE:%01.3f PR:%02.1f",Dishes_Info.weight * 5 /4095,Dishes_Info.price);
  72   3                              LcdShowStr(0x80,str);
  73   3                              Dishes_Info.money = Dishes_Info.weight * 5 /4095* Dishes_Info.price;
  74   3                              sprintf(str, "MONEY:%06.2fNo:%d", Dishes_Info.money, (int)Dishes_Info.Num);
  75   3                              LcdShowStr(0x80 + 0x40,str);
  76   3                              switch(key)
  77   3                              {
  78   4                                      case 'S': ++ flag ; flag %= 2; uClear_KeyPad();break;
  79   4                                      case 0xff:break;
  80   4                                      case '0':
  81   4                                      case '1':
  82   4                                      case '2':
  83   4                                      case '3':
  84   4                                      case '4':
  85   4                                      case '5':
  86   4                                      case '6':
  87   4                                      case '7':
  88   4                                      case '8':
  89   4                                      case '9': if(flag == 1)
  90   4                                                              {
  91   5                                                                      flag = 2;
  92   5                                                                      LcdShowStr(0x80,"                ");
  93   5                                                                      LcdShowStr(0x80+ 0x40,"                ");
  94   5                                                              }break;
  95   4                                      default:break;
  96   4                              }                       
  97   3                      }
  98   2                      if(flag == 2)
  99   2                      {
 100   3                              if(key == 'S')
 101   3                              {
 102   4                                      flag = 0;
 103   4                                      uClear_KeyPad();
 104   4                              }
 105   3                              else
 106   3                              {
 107   4                                      Dishes_Info.price = temp[key-'0'].price;
 108   4                                      Dishes_Info.Num = key - '0';
 109   4                                      sprintf(str, "菜名:%s, 单价:%f\n",temp[key-'0'].DisheName, Dishes_Info.price);
 110   4                                      Send_String(str);
 111   4                                      
 112   4                                      sprintf(str, "name:%s",temp[key-'0'].DisheName);
 113   4                                      LcdShowStr(0x80,str);
 114   4                                      
 115   4                                      sprintf(str, "price:%2.1f      ",Dishes_Info.price);    
 116   4                                      LcdShowStr(0x80 + 0x40,str);    
C51 COMPILER V9.60.0.0   BSP_MAIN                                                          02/13/2020 15:18:50 PAGE 3   

 117   4                              }
 118   3                              
 119   3                      }
 120   2                      
 121   2                      Delay200ms();
 122   2                      
 123   2                      
 124   2                      
 125   2              }
 126   1      }
 127          
 128          void lcd_display(void)
 129          {
 130   1              LcdInit();      
 131   1              LcdShowStr(0x80,"name: XXX");
 132   1              LcdShowStr(0x80 + 0x40,"Electronic scale");
 133   1              Delay200ms();
 134   1              Delay200ms();
 135   1              Delay200ms();
 136   1              Delay200ms();
 137   1              LcdShowStr(0x80,"WE:0.000 PR:00.0");
 138   1              LcdShowStr(0x80 + 0x40,"MONEY:000.0 No:0");     
 139   1      }
 140          
 141          
 142          
 143          
 144          
 145          
 146          
 147          
 148          
 149          
 150          
 151          
 152          
 153          
 154          
 155          
 156          
 157          
 158          
 159          
 160          
 161          
 162          
 163          
 164          
 165          
 166          
 167          
 168          
 169          
 170          
 171          
 172          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    677    ----
   CONSTANT SIZE    =    258    ----
   XDATA SIZE       =    112    ----
C51 COMPILER V9.60.0.0   BSP_MAIN                                                          02/13/2020 15:18:50 PAGE 4   

   PDATA SIZE       =   ----    ----
   DATA SIZE        =     14       2
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
