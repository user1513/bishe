C51 COMPILER V9.60.0.0   BSP_MAIN                                                          02/16/2020 15:54:25 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE BSP_MAIN
OBJECT MODULE PLACED IN ..\Objects\bsp_main.obj
COMPILER INVOKED BY: C:\keil\C51\BIN\C51.EXE ..\user\bsp_main.c OPTIMIZE(8,SPEED) BROWSE INCDIR(..\user;..\BSP\inc) DEBU
                    -G OBJECTEXTEND PRINT(..\Listings\bsp_main.lst) OBJECT(..\Objects\bsp_main.obj)

line level    source

   1          #include "inc.h"
   2          
   3          typedef struct _Dishe
   4          {
   5                  char* DisheName;
   6                  float price;
   7          }Dishes;
   8          
   9          typedef struct _info
  10          {
  11                  float weight;
  12                  float Peeled;
  13                  float price;
  14                  float money;
  15                  char Num;
  16                  
  17          }Info;
  18          
  19          xdata Dishes temp[] ={
  20          {"qingcai",2.2},
  21          {"dabaicai",2.8},
  22          {"xiguan",4.9},
  23          {"xiangjiao",71.3},
  24          {"xihongshi",88.2},
  25          {"niunan",99},
  26          {"jinju",19},
  27          {"niunan",22},
  28          {"qiezi",33},
  29          {"huasheng",55},
  30          {"niunai",88},};
  31          
  32          Info Dishes_Info = {0,0,2.2,0,0};
  33          
  34          //xdata Info Dishes_Info_[4] = {
  35          //{0,2.2,0,0},
  36          //{0,2.2,0,0},
  37          //{0,2.2,0,0},
  38          //{0,2.2,0,0},};
  39          
  40          void Delay200ms()               //@11.0592MHz
  41          {
  42   1              unsigned char i, j, k;
  43   1              _nop_();
  44   1              i = 2;
  45   1              j = 103;
  46   1              k = 147;
  47   1              do
  48   1              {
  49   2                      do
  50   2                      {
  51   3                              while (--k);
  52   3                      } while (--j);
  53   2              } while (--i);
  54   1      }
C51 COMPILER V9.60.0.0   BSP_MAIN                                                          02/16/2020 15:54:25 PAGE 2   

  55          
  56          
  57          
  58          void lcd_display(void);
  59          char xdata str[25] = 0;
  60          void main(void)
  61          {
  62   1              char key = 0;
  63   1              uint8_t flag = 0;
  64   1              lcd_display();
  65   1              Timer0Init();
  66   1              UartInit();
  67   1              while(1)
  68   1              {
  69   2                      key = Get_KeyPad() ;
  70   2                      Dishes_Info.weight = Get_ES_Val() - Dishes_Info.Peeled;
  71   2                      sprintf(str, "电压值:%f, key:%c\n",Dishes_Info.weight,key);
  72   2                      Send_String(str);
  73   2                      if(key == 'C' && flag == 0)
  74   2                      {
  75   3                              Dishes_Info.Peeled = Get_ES_Val();
  76   3                              uClear_KeyPad();
  77   3                      }
  78   2                      if(flag != 2)
  79   2                      {
  80   3                              sprintf(str, "WE:%01.3f PR:%02.1f",Dishes_Info.weight,Dishes_Info.price);
  81   3                              LcdShowStr(0x80,str);
  82   3                              Dishes_Info.money = Dishes_Info.weight * Dishes_Info.price;
  83   3                              sprintf(str, "MONEY:%06.2fNo:%d", Dishes_Info.money, (int)Dishes_Info.Num);
  84   3                              LcdShowStr(0x80 + 0x40,str);
  85   3                              switch(key)
  86   3                              {
  87   4                                      case 'S': ++ flag ; flag %= 2; uClear_KeyPad();break;
  88   4                                      case 0xff:break;
  89   4                                      case '0':
  90   4                                      case '1':
  91   4                                      case '2':
  92   4                                      case '3':
  93   4                                      case '4':
  94   4                                      case '5':
  95   4                                      case '6':
  96   4                                      case '7':
  97   4                                      case '8':
  98   4                                      case '9':
  99   4                                      case 'C':
 100   4                                                              if(flag == 1)
 101   4                                                              {
 102   5                                                                      flag = 2;
 103   5                                                                      LcdShowStr(0x80,"                ");
 104   5                                                                      LcdShowStr(0x80+ 0x40,"                ");
 105   5                                                              }break;
 106   4                                      default:break;
 107   4                              }                       
 108   3                      }
 109   2                      if(flag == 2)
 110   2                      {
 111   3                              if(key == 'S')
 112   3                              {
 113   4                                      flag = 0;
 114   4                                      uClear_KeyPad();
 115   4                              }
 116   3                              else if(key != 'C')
C51 COMPILER V9.60.0.0   BSP_MAIN                                                          02/16/2020 15:54:25 PAGE 3   

 117   3                              {
 118   4                                      Dishes_Info.price = temp[key-'0'].price;
 119   4                                      Dishes_Info.Num = key - '0';
 120   4                                      sprintf(str, "菜名:%s, 单价:%2.1f\n",temp[key-'0'].DisheName, Dishes_Info.price);
 121   4                                      Send_String(str);
 122   4                                      
 123   4                                      sprintf(str, " name:%s",temp[key-'0'].DisheName);
 124   4                                      LcdShowStr(0x80,str);
 125   4                                      
 126   4                                      sprintf(str, "price:%2.1f      ",Dishes_Info.price);    
 127   4                                      LcdShowStr(0x80 + 0x40,str);    
 128   4                              }
 129   3                              else
 130   3                              {
 131   4                                      sprintf(str, "Peeled:%f01.3", Dishes_Info.Peeled);
 132   4                                      Send_String(str);
 133   4                                      LcdShowStr(0x80,"  name:Peeled  ");
 134   4                                      
 135   4                                      sprintf(str, "val:%2.3f      ",Dishes_Info.Peeled);     
 136   4                                      LcdShowStr(0x80 + 0x40,str);    
 137   4                              }
 138   3                              
 139   3                      }
 140   2                      
 141   2                      Delay200ms();
 142   2      
 143   2              }
 144   1      }
 145          
 146          void lcd_display(void)
 147          {
 148   1              LcdInit();      
 149   1              LcdShowStr(0x80 ,"   Welcome use  ");
 150   1              LcdShowStr(0x80 + 0x40 ,"Electronic scale");
 151   1              Delay200ms();
 152   1              Delay200ms();
 153   1              LcdShowStr(0x80 ,"  class: b16   ");
 154   1              LcdShowStr(0x80+ 0x40,"   name: XXX    ");
 155   1              Delay200ms();
 156   1              Delay200ms();
 157   1              Delay200ms();
 158   1              Delay200ms();
 159   1              LcdShowStr(0x80,"WE:0.000 PR:00.0");
 160   1              LcdShowStr(0x80 + 0x40,"MONEY:000.0 No:0");     
 161   1      }
 162          
 163          
 164          
 165          
 166          
 167          
 168          
 169          
 170          
 171          
 172          
 173          
 174          
 175          
 176          
 177          
 178          
C51 COMPILER V9.60.0.0   BSP_MAIN                                                          02/16/2020 15:54:25 PAGE 4   

 179          
 180          
 181          
 182          
 183          
 184          
 185          
 186          
 187          
 188          
 189          
 190          
 191          
 192          
 193          
 194          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    737    ----
   CONSTANT SIZE    =    348    ----
   XDATA SIZE       =    102    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     17       2
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
