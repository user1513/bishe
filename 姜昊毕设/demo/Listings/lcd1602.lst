C51 COMPILER V9.01   LCD1602                                                               03/20/2020 22:49:26 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE LCD1602
OBJECT MODULE PLACED IN .\output\lcd1602.obj
COMPILER INVOKED BY: D:\Program Files (x86)\Keil C51\C51\BIN\C51.EXE source\lcd1602.c OMF2 DEBUG PRINT(.\Listings\lcd160
                    -2.lst) TABS(2) PREPRINT(.\Listings\lcd1602.i) OBJECT(.\output\lcd1602.obj)

line level    source

   1          /******************************************************************************
   2          文 件 名   : lcd1602.c
   3          
   4          @file lcd1602.c
   5          @brief LCD1602驱动, 参考链接: http://www.elecfans.com/xianshi/20171020567470.html
   6          
   7          ******************************************************************************/
   8          
   9          /*----------------------------------------------*
  10           * 包含头文件                                   *
  11           *----------------------------------------------*/
  12          #include "main.h"
  13          
  14          #ifdef LCD1602_DEV_DRIVER
  15          
  16          /*----------------------------------------------*
  17           * 宏定义                                 *
  18           *----------------------------------------------*/
  19          #define DEBUG   ( 0 )
  20          
  21          #if DEBUG
              #define log(X)    print_string(X)
              #else
  24          #define log(X)
  25          #endif
  26          
  27          #define LCD1602_PORT  P0
  28          sbit LCD1602_PIN_RS = P2^6;
  29          sbit LCD1602_PIN_RW = P2^5;
  30          sbit LCD1602_PIN_EN = P2^7;
  31          
  32          /*----------------------------------------------*
  33           * 枚举定义                            *
  34           *----------------------------------------------*/
  35          
  36          /*----------------------------------------------*
  37           * 结构体定义                              *
  38           *----------------------------------------------*/
  39          
  40          /*----------------------------------------------*
  41           * 外部函数原型说明                                     *
  42           *----------------------------------------------*/
  43          
  44          /*----------------------------------------------*
  45           * 内部函数原型说明                                   *
  46           *----------------------------------------------*/
  47          
  48          /*----------------------------------------------*
  49           * 全局变量                                     *
  50           *----------------------------------------------*/
  51          
  52          /*----------------------------------------------*
  53           * 常量定义                                       *
  54           *----------------------------------------------*/
C51 COMPILER V9.01   LCD1602                                                               03/20/2020 22:49:26 PAGE 2   

  55          
  56          /*---------------------------------------------------------------------------*/
  57          /**
  58          *@brief lcd1602延时1us
  59          *
  60          *
  61          *@param none
  62          *
  63          *@return 
  64          * 
  65          *
  66          *@note 根据数据手册,lcd的操作时序位ns级别,51单片机的指令周期为us级,因此延时时间远大于lcd操作时间
  67          *
  68          */
  69          static void lcd1602_delay_1us(void)
  70          {
  71   1        _nop_();
  72   1      }
  73          /*---------------------------------------------------------------------------*/
  74          
  75          /**
  76          *@brief lcd1602延时1ms
  77          *
  78          *
  79          *@param none
  80          *
  81          *@return 
  82          * 
  83          *
  84          *@note 经测试,初始化时延时1ms,该延时是在 11.0592MHz 下计算所得
  85          *
  86          */
  87          void lcd1602_delay_1ms(void)
  88          {
  89   1        unsigned char i, j;
  90   1      
  91   1        _nop_();
  92   1        i = 2;
  93   1        j = 199;
  94   1        do
  95   1        {
  96   2          while (--j);
  97   2        } while (--i);
  98   1      }
  99          
 100          /*---------------------------------------------------------------------------*/
 101          /**
 102          *@brief 读取lcd1602状态是否忙
 103          *
 104          *
 105          *@param none
 106          *
 107          *@return state 当前lcd状态
 108          * 
 109          *
 110          *@note 
 111          *
 112          */
 113          static uint8_t lcd1602_read_state(void)
 114          {
 115   1        uint8_t state;
 116   1      
C51 COMPILER V9.01   LCD1602                                                               03/20/2020 22:49:26 PAGE 3   

 117   1        ///下面为lcd操作时序
 118   1        LCD1602_PIN_RS = 0;
 119   1        LCD1602_PIN_RW = 1;
 120   1        LCD1602_PIN_EN = 1;
 121   1        lcd1602_delay_1us();
 122   1        state = LCD1602_PORT;
 123   1        LCD1602_PIN_EN = 0;
 124   1        lcd1602_delay_1us();
 125   1        
 126   1        return state;
 127   1      }
 128          /*---------------------------------------------------------------------------*/
 129          /**
 130          *@brief 等待lcd1602空闲
 131          *
 132          *
 133          *@param none
 134          *
 135          *@return
 136          * 
 137          *
 138          *@note 
 139          *
 140          */
 141          static void lcd1602_busy_wait(void)
 142          {
 143   1        uint16_t timeout;
 144   1      
 145   1        timeout  = 0xffff;
 146   1        while((lcd1602_read_state() & 0x80) == 0x80){
 147   2          timeout--;
 148   2          if(timeout == 0){
 149   3            log("lcd1602 state err\r\n");
 150   3            break;
 151   3          }
 152   2        }
 153   1        lcd1602_delay_1us();
 154   1      }
 155          /*---------------------------------------------------------------------------*/
 156          /**
 157          *@brief 向lcd1602写入数据
 158          *
 159          *
 160          *@param dat 写入的数据值
 161          *
 162          *@return
 163          * 
 164          *
 165          *@note 
 166          *
 167          */
 168          static void lcd1602_write_data(uint8_t dat)
 169          {
 170   1        ///下面为lcd1602操作时序
 171   1        lcd1602_busy_wait();
 172   1        LCD1602_PIN_RS = 1;
 173   1        LCD1602_PIN_RW = 0;
 174   1        LCD1602_PIN_EN = 0;
 175   1        LCD1602_PORT = dat;
 176   1        LCD1602_PIN_EN = 1;
 177   1        lcd1602_delay_1us();
 178   1        LCD1602_PIN_EN = 0; 
C51 COMPILER V9.01   LCD1602                                                               03/20/2020 22:49:26 PAGE 4   

 179   1      }
 180          /*---------------------------------------------------------------------------*/
 181          /**
 182          *@brief 向lcd1602写入命令
 183          *
 184          *
 185          *@param cmd 写入的命令值
 186          *
 187          *@return
 188          * 
 189          *
 190          *@note 
 191          *
 192          */
 193          static void lcd1602_write_command(uint8_t cmd)
 194          {
 195   1        ///下面为lcd1602操作时序
 196   1        lcd1602_busy_wait();
 197   1        LCD1602_PIN_RS = 0;
 198   1        LCD1602_PIN_RW = 0;
 199   1        LCD1602_PIN_EN = 0;
 200   1        LCD1602_PORT = cmd;
 201   1        LCD1602_PIN_EN = 1;
 202   1        lcd1602_delay_1us();
 203   1        LCD1602_PIN_EN = 0; 
 204   1      }
 205          /*---------------------------------------------------------------------------*/
 206          /**
 207          *@brief lcd1602初始化
 208          *
 209          *
 210          *@param none
 211          *
 212          *@return 
 213          * 
 214          *
 215          *@note 
 216          *
 217          */
 218          void lcd1602_init(void)
 219          {
 220   1        lcd1602_write_command(0x38); ///<设置16 X 2显示, 5 X 7点阵, 8位数据接口
 221   1        lcd1602_delay_1ms();  
 222   1        lcd1602_write_command(0x01); ///<显示清0,数据指针清0
 223   1        lcd1602_delay_1ms();  
 224   1        lcd1602_write_command(0x06); ///<设置写一个字符后地址加1
 225   1        lcd1602_delay_1ms();  
 226   1        lcd1602_write_command(0x0c); ///<设置开显示,不显示光标
 227   1        lcd1602_delay_1ms();
 228   1      }
 229          /*---------------------------------------------------------------------------*/
 230          /**
 231          *@brief 在lcd1602上显示一个字符
 232          *
 233          *
 234          *@param x x坐标值,取值范围 0 ~ 15
 235          *@param y y坐标值,取值范围 0 ~ 1
 236          *@param ch 要显示的字符
 237          *
 238          *@return 
 239          * 
 240          *
C51 COMPILER V9.01   LCD1602                                                               03/20/2020 22:49:26 PAGE 5   

 241          *@note 
 242          *
 243          */
 244          void lcd1602_display_char(    uint8_t      x, uint8_t y, uint8_t ch )
 245          {
 246   1        if(x > 15 || y > 1){
 247   2          log("lcd1602 pos err\r\n");
 248   2          return;
 249   2        }
 250   1        if(y == 0){
 251   2          lcd1602_write_command(x | 0x80);///<设置LCD1602第一行要显示的光标位置
 252   2        }else if(y == 1){
 253   2          lcd1602_write_command(x | 0x80 | 0x40);///<设置LCD1602第二行要显示的光标位置
 254   2        }
 255   1        lcd1602_write_data( ch );
 256   1      }
 257          /*---------------------------------------------------------------------------*/
 258          /**
 259          *@brief lcd1602显示字符串
 260          *
 261          *
 262          *@param x x坐标值,取值范围 0 ~ 15
 263          *@param y y坐标值,取值范围 0 ~ 1
 264          *@param str 要显示的字符串
 265          *
 266          *@return 
 267          * 
 268          *
 269          *@note 
 270          *
 271          */
 272          void lcd1602_display_string(    uint8_t       x, uint8_t y, uint8_t * str )
 273          {
 274   1        while(*str != '\0'){
 275   2          lcd1602_display_char(x, y, *str); ///<显示一个字符
 276   2          str++;  ///<显示下一个字符
 277   2          x++;    ///<显示下一个位置
 278   2          if(x > 15){
 279   3            log("lcd1602 display pos err\r\n");
 280   3          }
 281   2        }
 282   1      }
 283          /*---------------------------------------------------------------------------*/
 284          /**
 285          *@brief 清空lcd1602显示
 286          *
 287          *
 288          *@param none
 289          *
 290          *@return 
 291          * 
 292          *
 293          *@note 
 294          *
 295          */
 296          void lcd1602_clear_display(void)
 297          {
 298   1        lcd1602_write_command(0x01);
 299   1        lcd1602_delay_1ms();
 300   1      }
 301          /*---------------------------------------------------------------------------*/
 302          
C51 COMPILER V9.01   LCD1602                                                               03/20/2020 22:49:26 PAGE 6   

 303          #endif
 304          
 305          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    210    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----       5
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
